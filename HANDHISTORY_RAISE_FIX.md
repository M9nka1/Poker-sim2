# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–π–∑–∞–º–∏ –≤ HandHistory - –ò—Ç–µ—Ä–∞—Ü–∏—è 2

## üö® –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å $NaN –≤—Å–µ –µ—â–µ –æ—Å—Ç–∞–ª–∏—Å—å:

```
55: raises $NaN to $NaN
11: raises $NaN to $NaN
```

–ò –ø—Ä–æ–±–ª–µ–º–∞ —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º –ø—Ä–æ–±–µ–ª–æ–º:
```
Pio_IP_c3bBU: calls $85.00*** FLOP *** [Qs 5h 9c]
```

## üîç –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ addAction()

**–ü—Ä–∏—á–∏–Ω–∞ $NaN:**
–í —Ñ—É–Ω–∫—Ü–∏–∏ `addAction()` –º—ã —Å–æ—Ö—Ä–∞–Ω—è–ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–µ–π–∑–∞ –î–û –≤—ã–∑–æ–≤–∞ `processAction()`:

```javascript
// –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏
action.raiseAmount = finalAmount - this.currentBet; 
// –ù–æ this.currentBet –µ—â–µ –ù–ï –æ–±–Ω–æ–≤–ª–µ–Ω!

// –ü–û–¢–û–ú –≤—ã–∑—ã–≤–∞–ª—Å—è processAction(), –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–ª this.currentBet
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–µ—Ñ–ª–æ–ø–∞

**–ü—Ä–∏—á–∏–Ω–∞ —Å–∫–ª–µ–∏–≤–∞–Ω–∏—è:**
–í `generateHandHistoryText()` –º—ã –∏—Å–∫–∞–ª–∏ —Ç–æ–ª—å–∫–æ `*** FLOP ***`, –Ω–æ –ø—Ä–µ—Ñ–ª–æ–ø —Å–ø–æ—Ç –º–æ–≥ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ª—é–±—ã–µ –ø–æ—Å—Ç—Ñ–ª–æ–ø —Å–µ–∫—Ü–∏–∏.

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò–∑–º–µ–Ω–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –≤ addAction()

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –î–û –æ–±—Ä–∞–±–æ—Ç–∫–∏
const previousBet = this.currentBet;

// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ –°–ù–ê–ß–ê–õ–ê
const result = this.processAction(player, actionType, finalAmount);

// –°–æ–∑–¥–∞–µ–º action –æ–±—ä–µ–∫—Ç –ü–û–°–õ–ï —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
const action = {
  // ...
};

// –î–ª—è —Ä–µ–π–∑–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
if (actionType === 'raise') {
  action.raiseAmount = finalAmount - previousBet; // ‚úÖ –¢–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ!
  action.totalBet = finalAmount;
  action.previousBet = previousBet;
}
```

### 2. –£–ª—É—á—à–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–µ—Ñ–ª–æ–ø–∞

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –ø–æ—Å—Ç—Ñ–ª–æ–ø –º–∞—Ä–∫–µ—Ä—ã
const postflopMarkers = ['*** FLOP ***', '*** TURN ***', '*** RIVER ***', '*** SHOW DOWN ***', '*** SUMMARY ***'];

// –ù–∞–π—Ç–∏ —Å–∞–º—ã–π —Ä–∞–Ω–Ω–∏–π –ø–æ—Å—Ç—Ñ–ª–æ–ø –º–∞—Ä–∫–µ—Ä –∏ –æ–±—Ä–µ–∑–∞—Ç—å –¥–æ –Ω–µ–≥–æ
let cutIndex = handText.length;
for (const marker of postflopMarkers) {
  const markerIndex = handText.indexOf(marker);
  if (markerIndex !== -1 && markerIndex < cutIndex) {
    cutIndex = markerIndex;
  }
}

handText = handText.substring(0, cutIndex);
handText = handText.trimEnd(); // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
if (!handText.endsWith('\n')) {
  handText += '\n';
}
```

### 3. –£–ª—É—á—à–µ–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ All-in

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–µ–∫ –ü–û–°–õ–ï –æ–±—Ä–∞–±–æ—Ç–∫–∏
if (player.stack === 0) {
  action.allIn = true;
}
```

## ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
55: raises $NaN to $NaN
11: raises $NaN to $NaN
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
55: raises $57.50 to $172.50
11: raises $115.00 to $287.50
```

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏:**
```
Pio_IP_c3bBU: calls $85.00
*** FLOP *** [Qs 5h 9c]
```

## üéØ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞

–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ **race condition** - –º—ã –ø—ã—Ç–∞–ª–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `this.currentBet` –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è `raiseAmount` –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ `processAction()` –µ–≥–æ –æ–±–Ω–æ–≤–∏–ª. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –î–û –æ–±—Ä–∞–±–æ—Ç–∫–∏, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ, –∑–∞—Ç–µ–º —Å–æ–∑–¥–∞–µ–º action —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: 14 –¥–µ–∫–∞–±—Ä—è 2024
–°—Ç–∞—Ç—É—Å: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 