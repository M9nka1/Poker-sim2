<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HandHistory</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            background: #1a1a1a;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .section {
            background: #2a2a2a;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #444;
        }
        .title {
            color: #4ade80;
            font-size: 24px;
            margin-bottom: 15px;
        }
        .description {
            color: #9ca3af;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .handhistory-output {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            color: #00ff00;
            max-height: 500px;
            overflow-y: auto;
        }
        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .btn:hover {
            background: #2563eb;
        }
        .btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
        }
        .btn.success {
            background: #059669;
        }
        .btn.success:hover {
            background: #047857;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .status.success {
            background: #065f46;
            color: #34d399;
            border: 1px solid #059669;
        }
        .status.error {
            background: #7f1d1d;
            color: #f87171;
            border: 1px solid #dc2626;
        }
        .status.info {
            background: #1e40af;
            color: #93c5fd;
            border: 1px solid #3b82f6;
        }
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .feature {
            background: #374151;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #10b981;
        }
        .feature h4 {
            margin: 0 0 8px 0;
            color: #10b981;
        }
        .feature p {
            margin: 0;
            color: #d1d5db;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="section">
            <div class="title">üéØ –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HandHistory PokerStars</div>
            <div class="description">
                –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ HandHistory –≤ —Ñ–æ—Ä–º–∞—Ç–µ PokerStars, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º —Å –ø–æ–∫–µ—Ä–Ω—ã–º–∏ —Ç—Ä–µ–∫–µ—Ä–∞–º–∏
                (Holdem Manager 2, Hand2Note –∏ –¥—Ä.)
            </div>
            
            <div id="status" style="display: none;"></div>
            
            <div class="test-buttons">
                <button class="btn" onclick="startTest()">üöÄ –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>
                <button class="btn" onclick="exportHandHistory()" id="exportBtn" disabled>üíæ –≠–∫—Å–ø–æ—Ä—Ç HandHistory</button>
                <button class="btn" onclick="clearOutput()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
        </div>

        <div class="section">
            <div class="title">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HandHistory</div>
            <div class="description">
                –ù–∏–∂–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–¥–∞—á –≤ —Ñ–æ—Ä–º–∞—Ç–µ PokerStars:
            </div>
            <div id="handhistory-output" class="handhistory-output">
                –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç" –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HandHistory...
            </div>
        </div>

        <div class="section">
            <div class="title">‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</div>
            <div class="features">
                <div class="feature">
                    <h4>üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è</h4>
                    <p>–ö–∞–∂–¥–∞—è –Ω–æ–≤–∞—è —Ä–∞–∑–¥–∞—á–∞ –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞, tableId –∏ handNumber</p>
                </div>
                <div class="feature">
                    <h4>üÉè –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–∞—Ä—Ç</h4>
                    <p>–ö–∞—Ä—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É PokerStars: As, Kh, 7c, Td –∏ —Ç.–¥.</p>
                </div>
                <div class="feature">
                    <h4>üí∞ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ–π–∑—ã</h4>
                    <p>–†–µ–π–∑—ã –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ "raises $X.XX to $Y.YY" —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Å—É–º–º–∞–º–∏ –ø–æ–≤—ã—à–µ–Ω–∏—è</p>
                </div>
                <div class="feature">
                    <h4>üéØ All-in –ø–æ–¥–¥–µ—Ä–∂–∫–∞</h4>
                    <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –æ—Ç–º–µ—Ç–∫–∞ all-in –¥–µ–π—Å—Ç–≤–∏–π</p>
                </div>
                <div class="feature">
                    <h4>üèÜ Show Down —Å–µ–∫—Ü–∏—è</h4>
                    <p>–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ –≤—Å–∫—Ä—ã—Ç–∏—è –∫–∞—Ä—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ä—É–∫</p>
                </div>
                <div class="feature">
                    <h4>üìã Summary —Å–µ–∫—Ü–∏—è</h4>
                    <p>–ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–Ω–∫–µ, —Ä–µ–π–∫–µ, –¥–æ—Å–∫–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Socket.IO –∫–ª–∏–µ–Ω—Ç -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    
    <script>
        let socket = null;
        let currentSessionId = null;
        let currentTableId = null;
        let currentHandHistory = null;

        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.className = `status ${type}`;
            statusEl.textContent = message;
            statusEl.style.display = 'block';
        }

        function updateOutput(text) {
            const outputEl = document.getElementById('handhistory-output');
            outputEl.textContent = text;
        }

        function clearOutput() {
            updateOutput('–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç" –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HandHistory...');
            const exportBtn = document.getElementById('exportBtn');
            exportBtn.disabled = true;
        }

        function startTest() {
            showStatus('üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...', 'info');
            
            // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
            socket = io();
            
            socket.on('connect', () => {
                showStatus('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É, —Å–æ–∑–¥–∞—ë–º —Å–µ—Å—Å–∏—é...', 'success');
                createTestSession();
            });

            socket.on('session-created', (data) => {
                showStatus(`üéÆ –°–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞: ${data.sessionId}`, 'success');
                currentSessionId = data.sessionId;
                
                // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ —Å–µ—Å—Å–∏–∏
                socket.emit('join-session', {
                    sessionId: data.sessionId,
                    userId: 'test-user-1',
                    playerName: 'TestPlayer1'
                });
            });

            socket.on('session-joined', (data) => {
                showStatus('üöÄ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ —Å–µ—Å—Å–∏–∏, –∑–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É...', 'success');
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
                setTimeout(() => {
                    socket.emit('start-game', { sessionId: currentSessionId });
                }, 1000);
            });

            socket.on('game-started', (data) => {
                showStatus('üéØ –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å, –≤—ã–±–∏—Ä–∞–µ–º —Å—Ç–æ–ª...', 'success');
                currentTableId = 1; // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π —Å—Ç–æ–ª
                
                // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ —Å—Ç–æ–ª—É
                socket.emit('join-table', {
                    sessionId: currentSessionId,
                    tableId: currentTableId
                });
            });

            socket.on('table-joined', (data) => {
                showStatus('üÉè –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ —Å—Ç–æ–ª—É, –Ω–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä–∞—Ç—å...', 'success');
                
                // –ù–∞—á–∏–Ω–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∏–≥—Ä—É
                setTimeout(() => {
                    playAutomatically();
                }, 2000);
            });

            socket.on('hand-completed', (data) => {
                showStatus('üèÜ –†–∞–∑–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –ø–æ–ª—É—á–∞–µ–º HandHistory...', 'success');
                
                if (data.handHistory && data.handHistory.formatted) {
                    currentHandHistory = data.handHistory.formatted;
                    updateOutput(currentHandHistory);
                    
                    const exportBtn = document.getElementById('exportBtn');
                    exportBtn.disabled = false;
                    
                    showStatus('‚úÖ HandHistory —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!', 'success');
                } else {
                    showStatus('‚ùå –û—à–∏–±–∫–∞: HandHistory –Ω–µ –ø–æ–ª—É—á–µ–Ω', 'error');
                }
            });

            socket.on('error', (error) => {
                showStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            });
        }

        function createTestSession() {
            const settings = {
                preflopSpot: `PokerStars Hand #4400520541168030866: Hold'em No Limit ($5.00/$10.00) - 2024/12/14 2:21:47 GMT+03:00
Table 'PioSolver Table' 6-max Seat #6 is the button
Seat 1: Pio_OOP_3bet_SB ($1000.00 in chips)
Seat 2: Pio_BB ($1000.00 in chips)
Seat 3: Pio_EP ($1000.00 in chips)
Seat 4: Pio_MP ($1000.00 in chips)
Seat 5: Pio_CO ($1000.00 in chips)
Seat 6: Pio_IP_c3bBU ($1000.00 in chips)
Pio_OOP_3bet_SB: posts small blind $5.00
Pio_BB: posts big blind $10.00
*** HOLE CARDS ***
Pio_EP: folds
Pio_MP: folds
Pio_CO: folds
Pio_IP_c3bBU: raises $15.00 to $25.00
Pio_OOP_3bet_SB: raises $85.00 to $110.00
Pio_BB: folds
Pio_IP_c3bBU: calls $85.00`,
                boardSettings: {
                    flop: {
                        restricted: true,
                        cards: ['As', 'Kh', '7c']
                    }
                },
                playerRanges: {
                    player1: 'AA,KK,QQ,AK',
                    player2: 'AA,KK,QQ,AK'
                }
            };

            socket.emit('create-session', {
                userId: 'test-user-1',
                playerName: 'TestPlayer1',
                settings: settings
            });
        }

        function playAutomatically() {
            // –ü—Ä–æ—Å—Ç–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            let actionCount = 0;
            
            const actions = [
                { action: 'check', amount: 0 },
                { action: 'bet', amount: 5000 }, // $50
                { action: 'call', amount: 5000 },
                { action: 'check', amount: 0 },
                { action: 'bet', amount: 12000 }, // $120
                { action: 'call', amount: 12000 }
            ];

            function sendNextAction() {
                if (actionCount < actions.length) {
                    const action = actions[actionCount];
                    
                    socket.emit('player-action', {
                        sessionId: currentSessionId,
                        tableId: currentTableId,
                        action: action.action,
                        amount: action.amount
                    });
                    
                    actionCount++;
                    
                    // –°–ª–µ–¥—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(sendNextAction, 2000);
                }
            }

            sendNextAction();
        }

        function exportHandHistory() {
            if (!currentHandHistory) {
                showStatus('‚ùå –ù–µ—Ç HandHistory –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
                return;
            }

            // –°–æ–∑–¥–∞—ë–º blob –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
            const blob = new Blob([currentHandHistory], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hand_history_${currentTableId}_${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            showStatus('üíæ HandHistory —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ —Ñ–∞–π–ª', 'success');
        }
    </script>
</body>
</html> 