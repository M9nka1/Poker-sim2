<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #45a049;
        }
        .actions-display {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            min-height: 50px;
        }
        .actions-text {
            font-family: monospace;
            font-size: 14px;
        }
        .hero-actions-display {
            border-left: 3px solid #4CAF50;
        }
        .opponent-actions-display {
            border-left: 3px solid #f44336;
        }
        .log {
            background: #111;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .action-check { color: #90EE90; }
        .action-call { color: #87CEEB; }
        .action-bet { color: #FFD700; }
        .action-raise { color: #FF6347; }
        .action-fold { color: #A9A9A9; }
        .street-separator { color: #888; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π</h1>
        
        <div class="test-section">
            <h3>–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–µ–π—Å—Ç–≤–∏–π</h3>
            
            <div data-table-id="1">
                <h4>–ì–µ—Ä–æ–π (Hero)</h4>
                <div class="hero-actions-display actions-display">
                    <div class="actions-text"></div>
                </div>
                
                <h4>–û–ø–ø–æ–Ω–µ–Ω—Ç (Opponent)</h4>
                <div class="opponent-actions-display actions-display">
                    <div class="actions-text"></div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>–¢–µ—Å—Ç–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
            <button class="test-button" onclick="testHeroAction('check', 0)">Hero Check</button>
            <button class="test-button" onclick="testHeroAction('bet', 1000)">Hero Bet $10</button>
            <button class="test-button" onclick="testHeroAction('call', 500)">Hero Call $5</button>
            <button class="test-button" onclick="testHeroAction('raise', 2000)">Hero Raise $20</button>
            <button class="test-button" onclick="testHeroAction('fold', 0)">Hero Fold</button>
            
            <br><br>
            
            <button class="test-button" onclick="testOpponentAction('check', 0)">Opponent Check</button>
            <button class="test-button" onclick="testOpponentAction('bet', 1500)">Opponent Bet $15</button>
            <button class="test-button" onclick="testOpponentAction('call', 1000)">Opponent Call $10</button>
            <button class="test-button" onclick="testOpponentAction('raise', 3000)">Opponent Raise $30</button>
            <button class="test-button" onclick="testOpponentAction('fold', 0)">Opponent Fold</button>
            
            <br><br>
            
            <button class="test-button" onclick="changeStreet('turn')">–°–º–µ–Ω–∞ –Ω–∞ Turn</button>
            <button class="test-button" onclick="changeStreet('river')">–°–º–µ–Ω–∞ –Ω–∞ River</button>
            <button class="test-button" onclick="resetActions()">–°–±—Ä–æ—Å –¥–µ–π—Å—Ç–≤–∏–π</button>
        </div>
        
        <div class="test-section">
            <h3>–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h3>
            <div id="log" class="log"></div>
            <button class="test-button" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </div>
    </div>

    <script>
        // –ò–º–∏—Ç–∞—Ü–∏—è ActionTracker
        class TestActionTracker {
            constructor() {
                this.reset();
            }

            reset() {
                this.heroActions = {
                    flop: [],
                    turn: [],
                    river: []
                };
                this.opponentActions = {
                    flop: [],
                    turn: [],
                    river: []
                };
                this.currentStreet = 'flop';
                this.lastRecordedActions = new Map();
                this.log('ActionTracker —Å–±—Ä–æ—à–µ–Ω');
            }

            setStreet(street) {
                const oldStreet = this.currentStreet;
                this.currentStreet = street;
                this.log(`–£–ª–∏—Ü–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ —Å ${oldStreet} –Ω–∞ ${street}`);
                this.lastRecordedActions.clear();
            }

            addAction(playerId, action, amount, isHero) {
                const actionCode = this.getActionCode(action, amount);
                const playerActions = isHero ? this.heroActions : this.opponentActions;
                
                this.log(`–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è: ${isHero ? 'Hero' : 'Opponent'} ${action} ${amount} –Ω–∞ ${this.currentStreet}`);
                
                const actionKey = `${playerId}_${this.currentStreet}_${action}_${amount}`;
                
                if (this.lastRecordedActions.has(actionKey)) {
                    this.log(`‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ: ${actionCode}`);
                    return;
                }
                
                if (playerActions[this.currentStreet]) {
                    playerActions[this.currentStreet].push(actionCode);
                    this.lastRecordedActions.set(actionKey, true);
                    this.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: ${actionCode} –Ω–∞ ${this.currentStreet}`);
                } else {
                    this.log(`‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —É–ª–∏—Ü–∞: ${this.currentStreet}`);
                }
            }

            getActionCode(action, amount) {
                switch (action) {
                    case 'check':
                        return '<span class="action-check">Check</span>';
                    case 'call':
                        return `<span class="action-call">Call ${this.formatAmount(amount)}</span>`;
                    case 'bet':
                        return `<span class="action-bet">Bet ${this.formatAmount(amount)}</span>`;
                    case 'raise':
                        return `<span class="action-raise">Raise ${this.formatAmount(amount)}</span>`;
                    case 'fold':
                        return '<span class="action-fold">Fold</span>';
                    default:
                        return `<span class="action-check">${action}</span>`;
                }
            }

            formatAmount(amount) {
                const dollars = amount / 100;
                if (dollars >= 1000) {
                    return `$${(dollars / 1000).toFixed(1).replace('.0', '')}k`;
                } else if (dollars % 1 === 0) {
                    return `$${dollars}`;
                } else {
                    return `$${dollars.toFixed(2).replace(/\.?0+$/, '')}`;
                }
            }

            getActionsString(isHero) {
                const playerActions = isHero ? this.heroActions : this.opponentActions;
                const streets = [];

                if (playerActions.flop.length > 0) {
                    const flopActions = playerActions.flop.join(' ');
                    streets.push(`Flop: ${flopActions}`);
                }
                if (playerActions.turn.length > 0) {
                    const turnActions = playerActions.turn.join(' ');
                    streets.push(`Turn: ${turnActions}`);
                }
                if (playerActions.river.length > 0) {
                    const riverActions = playerActions.river.join(' ');
                    streets.push(`River: ${riverActions}`);
                }

                return streets.join('<span class="street-separator"> | </span>');
            }

            log(message) {
                const logElement = document.getElementById('log');
                const timestamp = new Date().toLocaleTimeString();
                logElement.innerHTML += `[${timestamp}] ${message}<br>`;
                logElement.scrollTop = logElement.scrollHeight;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        const tracker = new TestActionTracker();

        function updateActionDisplays() {
            const heroElement = document.querySelector('.hero-actions-display .actions-text');
            const opponentElement = document.querySelector('.opponent-actions-display .actions-text');
            
            if (heroElement) {
                const heroActionsString = tracker.getActionsString(true);
                heroElement.innerHTML = heroActionsString || '<em>–ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π</em>';
                tracker.log(`Hero display –æ–±–Ω–æ–≤–ª–µ–Ω: "${heroActionsString}"`);
            }
            
            if (opponentElement) {
                const opponentActionsString = tracker.getActionsString(false);
                opponentElement.innerHTML = opponentActionsString || '<em>–ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π</em>';
                tracker.log(`Opponent display –æ–±–Ω–æ–≤–ª–µ–Ω: "${opponentActionsString}"`);
            }
        }

        function testHeroAction(action, amount) {
            tracker.addAction('hero-123', action, amount, true);
            updateActionDisplays();
        }

        function testOpponentAction(action, amount) {
            tracker.addAction('opponent-456', action, amount, false);
            updateActionDisplays();
        }

        function changeStreet(street) {
            tracker.setStreet(street);
            updateActionDisplays();
        }

        function resetActions() {
            tracker.reset();
            updateActionDisplays();
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        updateActionDisplays();
    </script>
</body>
</html> 